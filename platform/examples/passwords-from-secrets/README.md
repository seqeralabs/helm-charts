# Provide passwords with Kubernetes Secrets

Storing passwords in a helm chart values files is not secure, as these files are often checked into
source control. Instead, you can store passwords in Kubernetes Secrets and reference them in the
Platform helm chart values.

This example shows how to use Kubernetes Secrets to provide passwords to the Platform helm chart.

Multiple passwords are required by the Platform components, e.g. database passwords, (optional)
redis passwords, the JWT seed value, etc. This example shows how to create a Kubernetes Secret
containing all required passwords, and how to reference these passwords in the Platform helm chart
values.

In most production deployments, a secure method of storing and retrieving passwords should be used
instead of manually creating Kubernetes Secrets. Just to provide an example, the [External Secrets
Operator](https://external-secrets.io/) could be used along with a secret store such as AWS Secrets
Manager, HashiCorp Vault, etc. This example does not cover that, but focuses on how to reference
Kubernetes Secrets in the Platform helm chart values.

## Create a Kubernetes Secret with passwords

Create a file named `passwords-secret.yaml` with the following content:

```yaml
apiVersion: v1
kind: Secret
type: Opaque
metadata:
  name: platform-passwords
stringData:
  database-password: your_database_password
  TOWER_LICENSE: your_tower_license
  redis-password: your_redis_password
  jwt-seed: your_jwt_seed_value
  TOWER_CRYPTO_SECRETKEY: your_tower_crypto_secretkey
  TOWER_SMTP_PASSWORD: your_tower_smtp_password
```

Replace the placeholder values with your actual passwords and secret values.
Then, create the Secret in your Kubernetes cluster:

```bash
kubectl apply -f passwords-secret.yaml
```

The secret named `platform-passwords` is now present in the cluster in the `default`
namespace.

## Reference the passwords in the Platform helm chart values

In the values file for your Platform helm chart installation, you can reference the
passwords stored in this Secret as shown below, along with other required Platform configuration
values (not shown here for brevity):

```yaml
global:
  platformDatabase:
    existingSecretName: "platform-passwords"
    existingSecretKey: "database-password"

platform:
  licenseSecretName: "platform-passwords"
  # licenseSecretKey: "TOWER_LICENSE" # Default key was used, this can be omitted

  jwtSeedSecretName: "platform-passwords"
  jwtSeedSecretKey: "jwt-seed"

  cryptoSeedSecretName: "platform-passwords"
  # cryptoSeedSecretKey: "TOWER_CRYPTO_SECRETKEY" # Default key was used, this can be omitted

  smtp:
    existingSecretName: "platform-passwords"
    # existingSecretKey: "TOWER_SMTP_PASSWORD" # Default key was used, this can be omitted

redis:
  existingSecretName: "platform-passwords"
  existingSecretKey: "redis-password"
```

The helm chart allows you to customize the secret keys used for each sensitive value.
This will make the Platform helm chart use the passwords stored in the `platform-passwords`
Kubernetes Secret by setting the appropriate environment variables on the required Platform
components.

Note that only the platform database and the license are mandatory, the JWT seed and crypto key will
be auto-generated by the helm chart if not provided, and SMTP and Redis authentication are optional
components.
